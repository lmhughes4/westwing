Merged the =published_API= branch back into the trunk.

Fixed file count based tests.
